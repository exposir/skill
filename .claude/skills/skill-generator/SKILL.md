---
name: skill-generator
description: 生成和更新 skill。当用户说"帮我总结成 skill"、"生成一个 skill"、"把这个做成 skill"、"创建 skill"、"更新 skill"、"修改 skill"、"create skill"、"update skill" 时使用。
---

# Skill 生成器

自动从对话、文件或口头描述中提炼内容，生成或更新 Claude Code skill。

## 工作模式判断

1. **检查用户意图**：
   - 包含"更新"、"修改"、"改进"、"update" → 更新模式
   - 包含"生成"、"创建"、"总结成"、"create" → 创建模式

2. **检查 skill 是否存在**：
   - 用户指定的 skill 名称已存在 → 更新模式
   - 不存在 → 创建模式

## 内容来源识别

按优先级判断内容来源：

| 优先级 | 来源 | 判断依据 |
|-------|------|---------|
| 1 | 指定文件 | 用户提供了文件路径 |
| 2 | 当前对话 | 对话中有可提炼的模式、指令、偏好 |
| 3 | 口头描述 | 用户直接描述 skill 功能 |

如果来源不明确，主动询问：
> "我可以从以下来源生成 skill：
> - A) 当前对话内容
> - B) 指定文件
> - C) 你来描述
>
> 选择哪个？"

---

## 创建模式

### 步骤 1：收集信息

**从对话提取**：
- 分析对话中重复出现的指令和偏好
- 识别用户纠正过的行为模式
- 提炼核心规则和输出格式要求

**从文件提取**：
- 读取指定文件内容
- 总结关键知识点、操作流程、规范要求

**从口头描述**：
- 直接使用用户描述
- 如信息不足，追问：用途、触发时机、输出格式

### 步骤 2：确定 Skill 名称

- 用户指定 → 直接使用
- 未指定 → 从内容推断，使用小写字母和连字符（如 `code-review`）

### 步骤 3：生成 Skill 内容

使用以下模板结构：

```markdown
---
name: <skill-name>
description: <清晰描述功能和触发时机，包含用户可能使用的多种表述>
---

# <Skill 标题>

## 适用场景
<什么情况下使用这个 skill>

## 执行流程
<具体步骤，使用编号列表>

## 示例
<输入输出示例，帮助理解预期行为>

## 注意事项
<边界条件、常见错误、特殊处理>
```

**description 编写要点**：
- 包含多种触发表述（中英文）
- 明确说明"当用户...时使用"
- 控制在 1024 字符以内

### 步骤 4：写入文件

```bash
mkdir -p .claude/skills/<skill-name>
# 写入 SKILL.md
```

---

## 更新模式

### 步骤 1：识别目标 Skill

- 用户明确指定名称 → 直接定位
- 用户说"更新刚才那个 skill" → 从对话上下文推断
- 不确定 → 列出现有 skills：

```bash
ls .claude/skills/
```

让用户选择要更新的 skill。

### 步骤 2：备份现有版本

执行备份，格式为 `SKILL.md.bak.YYYYMMDD-HHMMSS`：

```bash
cp .claude/skills/<name>/SKILL.md \
   .claude/skills/<name>/SKILL.md.bak.$(date +%Y%m%d-%H%M%S)
```

### 步骤 3：解析反馈

| 反馈类型 | 处理策略 |
|---------|---------|
| 口头反馈 | "把 X 改成 Y" → 定位并替换对应内容 |
| 对比预期 | 用户指出实际 vs 预期 → 分析差异原因，调整规则 |
| 累积改进 | 收集本次对话中的多次修正 → 合并为一次更新 |

### 步骤 4：执行更新

1. 读取现有 SKILL.md
2. 根据反馈修改对应部分
3. 保持未涉及的内容不变
4. 写入更新后的文件

---

## 完成后输出

创建或更新完成后，输出以下信息：

```markdown
## Skill 已<创建/更新>

- 名称：`<skill-name>`
- 路径：`.claude/skills/<skill-name>/SKILL.md`
- 备份：`<备份文件路径>`（仅更新时显示）

**触发方式：**
- 自动：当你说 "<示例触发词>" 时自动使用
- 手动：`/<skill-name>`
```

---

## 边界情况处理

| 场景 | 处理方式 |
|-----|---------|
| Skill 名称冲突 | 提示已存在，询问："是要更新这个 skill，还是换个名称？" |
| 内容来源不明确 | 主动询问来源（对话/文件/描述） |
| 描述信息不足 | 追问关键信息：用途、触发时机、输出格式 |
| 备份文件过多（>5个） | 提示用户可清理旧备份：`ls .claude/skills/<name>/*.bak.*` |

## 不处理的情况

- 不自动删除 skill（避免误删，需用户手动删除）
- 不跨项目同步（仅操作当前项目 `.claude/skills/` 目录）
- 不修改个人目录 `~/.claude/skills/`（如需修改，用户需明确指定）
