---
name: skill-evolution
description: 自我进化的 Skill 系统。当发现新模式、解决问题、学到新知识时提示积累；当 skill 建议导致错误时提示修正；支持验证 skill 准确性。触发词包括"进化 skill"、"积累知识"、"修正 skill"、"验证 skill"、"skill 分类"、"skill 配置"。
---

# Skill 自我进化系统

通用的 skill 自我进化系统，支持知识积累、错误修正、准确性验证。采用提示模式，由用户决定是否执行。

## 快速导航

| 功能 | 触发词 | 说明 |
|-----|-------|------|
| [知识积累](#自我进化积累知识) | "进化 skill"、"积累知识" | 将新发现的知识加入 skill |
| [错误修正](#自我纠正修正错误) | "修正 skill" | 修正 skill 中的错误内容 |
| [准确性验证](#自我验证检查准确性) | "验证 skill" | 检查 skill 内容是否仍然有效 |
| [分类管理](#用户自定义分类) | "skill 分类" | 查看/创建/删除分类 |
| [配置修改](#配置管理) | "skill 配置" | 修改进化系统配置 |

---

## 核心能力

| 能力 | 说明 | 触发方式 |
|-----|------|---------|
| 自我进化 | 积累新知识到 skill | 检测到可复用模式时提示 |
| 自我纠正 | 修正错误的 skill 内容 | skill 建议导致失败时提示 |
| 自我验证 | 检查 skill 是否仍然准确 | 手动触发或定期提示 |
| 个性化 | 适应项目风格 | 分析项目代码后建议 |

## 管理范围（可配置）

```
全部 skill     → .claude/skills/*
特定领域       → .claude/skills/<domain>/*
项目专属知识   → .claude/skills/project-knowledge/
```

---

## 进化检测与提示

### 检测时机

| 场景 | 检测信号 | 提示内容 |
|-----|---------|---------|
| 解决了一个问题 | 多次尝试后成功 | "这个解决方案要积累到 skill 吗？" |
| 发现可复用模式 | 代码结构有通用性 | "这个模式可以抽象为 skill" |
| 学到新知识 | 查阅文档/搜索后解决 | "要把这个知识点记录下来吗？" |
| Skill 导致错误 | 按 skill 建议执行后失败 | "skill 内容可能有误，要修正吗？" |
| 会话即将结束 | 用户说"结束"或长时间无操作 | "本次会话学到了什么，要积累吗？" |

### 提示格式

当检测到进化机会时，使用以下格式提示：

```markdown
💡 **进化机会检测**

类型：[新知识 / 模式发现 / 问题解决 / 需要修正]
内容摘要：<简要描述>
建议目标：<目标 skill 或新建 skill>

要现在处理吗？(Y/N/稍后)
```

### 不打扰原则

- 同一会话中相似提示最多出现 1 次
- 用户拒绝后，同类型提示本次会话不再出现
- 专注编码时（连续工具调用）延迟提示

---

## 自我进化：积累知识

用户确认后执行以下流程：

### 步骤 1：确定目标

```
├─ 已有 skill → 追加内容
└─ 新分类 → 创建新 skill
```

询问用户：
> "要添加到哪个 skill？"
> - A) <已有 skill 列表>
> - B) 创建新 skill

### 步骤 2：格式化内容

```
├─ 提取核心知识点
├─ 添加示例代码（如有）
└─ 标注来源和日期
```

### 步骤 3：添加内容标记

```markdown
<!-- Added: YYYY-MM-DD | source: 来源描述 | trigger: 触发类型 -->
## 新增内容标题

内容正文...
```

### 步骤 4：写入文件

```bash
# 如果是更新已有 skill，先备份
cp .claude/skills/<name>/SKILL.md \
   .claude/skills/<name>/SKILL.md.bak.$(date +%Y%m%d-%H%M%S)

# 追加或写入新内容
```

### 步骤 5：确认完成

```markdown
✅ **知识已积累**

- 目标：`<skill-name>`
- 路径：`.claude/skills/<skill-name>/SKILL.md`
- 新增内容：<内容摘要>
```

---

## 自我纠正：修正错误

当 skill 建议导致错误时：

### 步骤 1：定位问题

```
├─ 找到导致错误的 skill 段落
└─ 分析错误原因
```

### 步骤 2：确认修正内容

向用户展示：
```markdown
**发现需要修正的内容**

Skill：`<skill-name>`
问题段落：
> <原内容摘要>

错误原因：<分析>

建议修正为：
> <新内容摘要>

确认修正？(Y/N)
```

### 步骤 3：执行修正

```bash
# 备份原文件
cp .claude/skills/<name>/SKILL.md \
   .claude/skills/<name>/SKILL.md.bak.$(date +%Y%m%d-%H%M%S)
```

### 步骤 4：添加修正标记

```markdown
<!-- Corrected: YYYY-MM-DD | was: 旧内容摘要 | reason: 修正原因 -->
## 修正后的内容

内容正文...
```

---

## 自我验证：检查准确性

### 触发方式

| 方式 | 说明 |
|-----|------|
| 手动触发 | 用户说"验证 skill"或"检查 skill 准确性" |
| 定期提示 | skill 超过 30 天未验证时提示 |
| 失败触发 | 同一 skill 多次导致问题时建议验证 |

### 验证流程

```
1. 选择验证范围
   ├─ 单个 skill
   ├─ 某个分类
   └─ 全部 skill

2. 逐项检查
   ├─ 代码示例是否能运行
   ├─ API/命令是否仍有效
   ├─ 描述是否与实际一致
   └─ 是否有过时内容

3. 生成报告
   ├─ ✅ 有效内容
   ├─ ⚠️ 需要更新
   └─ ❌ 已失效
```

### 验证报告格式

```markdown
## Skill 验证报告 (YYYY-MM-DD)

### 验证范围：<范围描述>

| 状态 | Skill | 内容 | 说明 |
|-----|-------|------|------|
| ✅ | skill-name | 某功能 | 正常工作 |
| ⚠️ | skill-name | 某功能 | 建议更新 |
| ❌ | skill-name | 某功能 | 已失效 |

### 建议操作
1. 更新 xxx
2. 删除 xxx
3. ...
```

### 验证后更新标记

```markdown
<!-- Validated: YYYY-MM-DD | status: passed/updated | by: user -->
```

---

## 用户自定义分类

### 查看分类

用户说："skill 分类" 或 "我有哪些 skill"

输出：
```markdown
## 当前 Skill 分类

| 分类 | 路径 | Skill 数量 | 最后更新 |
|-----|------|-----------|---------|
| code-review | .claude/skills/code-review/ | 1 | 2026-01-13 |
| frontend-daily | .claude/skills/frontend-daily/ | 1 | 2026-01-13 |
| ... | ... | ... | ... |
```

### 创建分类

用户说："创建一个 <分类名> 分类"

流程：
1. 确认分类名称（小写字母、连字符）
2. 创建目录 `.claude/skills/<分类名>/`
3. 创建基础 `SKILL.md` 模板
4. 更新配置文件

### 删除分类

用户说："删除 <分类名> 分类"

流程：
1. 确认分类存在
2. 二次确认（防止误删）
3. 备份后删除
4. 更新配置文件

---

## 配置管理

配置文件位置：`.claude/skills/skill-evolution/config.md`

### 查看配置

用户说："skill 配置"

### 修改配置

用户说："修改 skill 配置" 或直接说具体修改，如：
- "把验证提示改成 60 天"
- "忽略 frontend-daily skill"
- "只管理 patterns 分类"

### 可配置项

| 配置项 | 默认值 | 说明 |
|-------|-------|------|
| 管理范围 | 全部 skill | 全部/特定分类/项目知识 |
| 进化提示上限 | 3 次/会话 | 同一会话最多提示次数 |
| 验证周期 | 30 天 | 多久未验证时提示 |
| 忽略列表 | skill-evolution | 不进化的 skill |
| 备份保留数 | 5 | 保留最近几个备份 |

---

## Hooks 自动检测（可选）

Hooks 用于自动检测进化机会，仅提示不自动修改。

### 安装方式

```bash
# 将 hooks 配置合并到 .claude/settings.json
```

### Hooks 配置

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Bash",
        "hooks": [{
          "type": "command",
          "command": "bash .claude/skills/skill-evolution/hooks/detect-failure.sh"
        }]
      }
    ],
    "Stop": [
      {
        "matcher": "",
        "hooks": [{
          "type": "command",
          "command": "bash .claude/skills/skill-evolution/hooks/session-summary.sh"
        }]
      }
    ]
  }
}
```

### Hook 说明

| Hook | 触发时机 | 作用 |
|-----|---------|------|
| detect-failure.sh | Bash 命令失败后 | 检测是否因 skill 导致，输出提示信号 |
| session-summary.sh | 会话结束时 | 统计可积累的知识，输出提示信号 |

---

## 快捷命令速查

| 命令 | 作用 |
|-----|------|
| "进化 skill" | 手动触发知识积累 |
| "积累知识" | 同上 |
| "修正 skill" | 手动触发修正流程 |
| "验证 skill" | 手动触发验证 |
| "skill 分类" | 查看/管理分类 |
| "skill 配置" | 查看/修改配置 |

---

## 质量准则

### 应该积累

- 通用、可复用的模式
- 常见问题的解决方案
- 经过验证的最佳实践
- 工具/框架的使用技巧
- 踩过的坑和规避方法

### 不应积累

- 项目特定的业务逻辑
- 未经验证的临时方案
- 重复已有的内容
- 不完整的示例
- 个人偏好（无客观理由）

---

## 文件结构

```
.claude/skills/skill-evolution/
├── SKILL.md          ← 本文件（主文档）
├── config.md         ← 用户配置
└── hooks/            ← 自动检测脚本（可选）
    ├── detect-failure.sh
    └── session-summary.sh
```
