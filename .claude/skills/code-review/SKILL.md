---
name: code-review
description: å®¡æŸ¥ TypeScript/JavaScript ä»£ç ã€‚å½“ç”¨æˆ·è¯·æ±‚ä»£ç å®¡æŸ¥ã€review ä»£ç ã€æ£€æŸ¥ä»£ç è´¨é‡ã€æˆ–æåˆ° "å¸®æˆ‘çœ‹çœ‹è¿™æ®µä»£ç " æ—¶ä½¿ç”¨ã€‚
---

# TypeScript/JavaScript ä»£ç å®¡æŸ¥

## å®¡æŸ¥æµç¨‹

1. **ç†è§£ä¸Šä¸‹æ–‡**ï¼šå…ˆè¯» PR æè¿°å’Œå…³è” issueï¼Œäº†è§£ä»£ç ç›®çš„
2. **åˆ†å±‚å®¡æŸ¥**ï¼šæŒ‰ä¼˜å…ˆçº§ä¾æ¬¡æ£€æŸ¥å„ä¸ªç»´åº¦
3. **ç»™å‡ºå»ºè®®**ï¼šæä¾›å…·ä½“ã€å¯æ“ä½œçš„æ”¹è¿›å»ºè®®

<!-- Evolved: 2026-01-13 | type: æ— æè¿›åŒ– | sources: Microsoft Engineering Playbook, GitHub awesome-copilot -->
## è¯„è®ºåˆ†çº§ç³»ç»Ÿ

ä½¿ç”¨æ ‡è®°åŒºåˆ†è¯„è®ºä¼˜å…ˆçº§ï¼Œè®©ä½œè€…æ¸…æ¥šå“ªäº›å¿…é¡»ä¿®å¤ï¼š

| æ ‡è®° | å«ä¹‰ | æ˜¯å¦é˜»å¡åˆå¹¶ |
|-----|------|-------------|
| ğŸ”´ `[Blocker]` | å®‰å…¨æ¼æ´ã€é€»è¾‘é”™è¯¯ã€ç ´åæ€§å˜æ›´ | **æ˜¯** |
| ğŸŸ¡ `[Important]` | ä»£ç è´¨é‡ã€ç¼ºå°‘æµ‹è¯•ã€æ€§èƒ½é—®é¢˜ | éœ€è®¨è®º |
| ğŸŸ¢ `[Suggestion]` | å¯è¯»æ€§æ”¹è¿›ã€æœ€ä½³å®è·µå»ºè®® | å¦ |
| ğŸ’­ `[Nitpick]` | ä¸ªäººåå¥½ã€é£æ ¼å»ºè®® | å¦ |

**è¯„è®ºæ ¼å¼ç¤ºä¾‹ï¼š**
```
ğŸ”´ [Blocker] å®‰å…¨æ€§é—®é¢˜

è¿™é‡Œå­˜åœ¨ SQL æ³¨å…¥é£é™©ã€‚ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°æŸ¥è¯¢ä¸­ã€‚

**å»ºè®®ä¿®å¤ï¼š**
ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢æ›¿ä»£å­—ç¬¦ä¸²æ‹¼æ¥ã€‚
```

## å®¡æŸ¥ç»´åº¦ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### 1. å®‰å…¨æ€§æ£€æŸ¥ (Critical)

- [ ] **æ³¨å…¥é£é™©**ï¼šæ£€æŸ¥ SQL æ³¨å…¥ã€XSSã€å‘½ä»¤æ³¨å…¥
- [ ] **æ•æ„Ÿæ•°æ®**ï¼šé¿å…ç¡¬ç¼–ç å¯†é’¥ã€tokenã€å¯†ç 
- [ ] **è¾“å…¥éªŒè¯**ï¼šç”¨æˆ·è¾“å…¥æ˜¯å¦ç»è¿‡éªŒè¯å’Œæ¸…ç†
- [ ] **ä¾èµ–å®‰å…¨**ï¼šæ˜¯å¦ä½¿ç”¨å·²çŸ¥æœ‰æ¼æ´çš„ä¾èµ–
- [ ] **æƒé™æ§åˆ¶**ï¼šæ˜¯å¦æœ‰é€‚å½“çš„è®¤è¯å’Œæˆæƒæ£€æŸ¥

#### ä¾èµ–å®‰å…¨å®¡æŸ¥

ç°ä»£å®‰å…¨æ¼æ´å¾ˆå¤§æ¯”ä¾‹æ¥è‡ªç¬¬ä¸‰æ–¹ä¾èµ–ï¼š

```bash
# æ£€æŸ¥ä¾èµ–æ¼æ´
npm audit
# æˆ–
pnpm audit
```

| æ£€æŸ¥é¡¹ | è¯´æ˜ |
|-------|------|
| æ–°å¢ä¾èµ– | æ˜¯å¦å¿…è¦ï¼Ÿæ˜¯å¦æœ‰æ›´è½»é‡æ›¿ä»£ï¼Ÿ |
| ä¾èµ–ç‰ˆæœ¬ | æ˜¯å¦é”å®šç‰ˆæœ¬ï¼Ÿé¿å… `^` æˆ– `*` |
| å·²çŸ¥æ¼æ´ | `npm audit` æ˜¯å¦æœ‰ high/critical è­¦å‘Šï¼Ÿ |
| ç»´æŠ¤çŠ¶æ€ | ä¾èµ–æ˜¯å¦ä»åœ¨ç»´æŠ¤ï¼Ÿæœ€è¿‘æ›´æ–°æ—¶é—´ï¼Ÿ |

```typescript
// å±é™©ç¤ºä¾‹
const query = `SELECT * FROM users WHERE id = ${userId}`; // SQL æ³¨å…¥é£é™©
element.innerHTML = userInput; // XSS é£é™©

// å®‰å…¨ç¤ºä¾‹
const query = `SELECT * FROM users WHERE id = $1`; // å‚æ•°åŒ–æŸ¥è¯¢
element.textContent = userInput; // å®‰å…¨çš„æ–‡æœ¬æ’å…¥
```

### 2. æ­£ç¡®æ€§æ£€æŸ¥ (High)

- [ ] **è¾¹ç•Œæ¡ä»¶**ï¼šç©ºå€¼ã€ç©ºæ•°ç»„ã€è¾¹ç•Œå€¼å¤„ç†
- [ ] **ç±»å‹å®‰å…¨**ï¼šTypeScript ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œé¿å… `any`
- [ ] **é”™è¯¯å¤„ç†**ï¼šå¼‚å¸¸æ˜¯å¦è¢«æ­£ç¡®æ•è·å’Œå¤„ç†
- [ ] **å¼‚æ­¥é€»è¾‘**ï¼šPromise/async-await æ˜¯å¦æ­£ç¡®ä½¿ç”¨
- [ ] **ç«æ€æ¡ä»¶**ï¼šå¹¶å‘æ“ä½œæ˜¯å¦å®‰å…¨

#### TypeScript æ·±åº¦æ£€æŸ¥

| æ£€æŸ¥é¡¹ | é—®é¢˜ä¿¡å· | å»ºè®® |
|-------|---------|------|
| `any` æ»¥ç”¨ | æœç´¢ `: any`, `as any` | ä½¿ç”¨å…·ä½“ç±»å‹æˆ– `unknown` |
| è¿‡å¤šç±»å‹æ–­è¨€ | é¢‘ç¹ä½¿ç”¨ `as Type` | é‡æ–°è®¾è®¡ç±»å‹ï¼Œå‡å°‘æ–­è¨€ |
| ç¼ºå°‘ä¸¥æ ¼æ¨¡å¼ | `strictNullChecks: false` | å»ºè®®å¼€å¯ä¸¥æ ¼æ¨¡å¼ |
| interface vs type | æ··ç”¨ä¸ä¸€è‡´ | interface ç”¨äºæ‰©å±•ï¼Œtype ç”¨äºè”åˆ/å·¥å…·ç±»å‹ |
| API ç±»å‹ä¸åŒ¹é… | å‰ç«¯ç±»å‹ä¸åç«¯å“åº”ä¸ä¸€è‡´ | ç¡®ä¿ç±»å‹åæ˜ çœŸå® API å“åº”ï¼ŒåŒ…æ‹¬å¯é€‰å­—æ®µ |

```typescript
// é—®é¢˜ç¤ºä¾‹
async function fetchData() {
  const data = await api.get(); // æœªå¤„ç†é”™è¯¯
  return data.items.map(x => x.name); // data.items å¯èƒ½ä¸º undefined
}

// æ”¹è¿›ç¤ºä¾‹
async function fetchData() {
  try {
    const data = await api.get();
    return data?.items?.map(x => x.name) ?? [];
  } catch (error) {
    console.error('Failed to fetch data:', error);
    return [];
  }
}
```

### 3. æ€§èƒ½æ£€æŸ¥ (Medium)

- [ ] **ç®—æ³•å¤æ‚åº¦**ï¼šé¿å…ä¸å¿…è¦çš„ O(nÂ²) æ“ä½œ
- [ ] **å†…å­˜æ³„æ¼**ï¼šäº‹ä»¶ç›‘å¬å™¨ã€å®šæ—¶å™¨æ˜¯å¦æ¸…ç†
- [ ] **é‡å¤è®¡ç®—**ï¼šæ˜¯å¦æœ‰å¯ç¼“å­˜æˆ– memo çš„è®¡ç®—
- [ ] **æ‰¹é‡æ“ä½œ**ï¼šæ˜¯å¦å¯ä»¥æ‰¹é‡å¤„ç†è€Œéé€ä¸ªå¤„ç†
- [ ] **æ‡’åŠ è½½**ï¼šå¤§æ•°æ®æ˜¯å¦æŒ‰éœ€åŠ è½½

```typescript
// æ€§èƒ½é—®é¢˜
users.forEach(user => {
  const role = roles.find(r => r.id === user.roleId); // O(n*m)
});

// ä¼˜åŒ–æ–¹æ¡ˆ
const roleMap = new Map(roles.map(r => [r.id, r])); // O(m)
users.forEach(user => {
  const role = roleMap.get(user.roleId); // O(1)
}); // æ€»ä½“ O(n+m)
```

### 4. å¯ç»´æŠ¤æ€§æ£€æŸ¥ (Medium)

- [ ] **å‘½åè§„èŒƒ**ï¼šå˜é‡ã€å‡½æ•°å‘½åæ˜¯å¦æ¸…æ™°è¡¨æ„
- [ ] **å‡½æ•°èŒè´£**ï¼šå•ä¸€èŒè´£ï¼Œå‡½æ•°ä¸è¶…è¿‡ 30 è¡Œ
- [ ] **ä»£ç é‡å¤**ï¼šæ˜¯å¦æœ‰å¯æŠ½å–çš„å…¬å…±é€»è¾‘
- [ ] **é­”æ³•æ•°å­—**ï¼šæ˜¯å¦ä½¿ç”¨å¸¸é‡æ›¿ä»£ç¡¬ç¼–ç å€¼
- [ ] **æ³¨é‡Šè´¨é‡**ï¼šå¤æ‚é€»è¾‘æ˜¯å¦æœ‰å¿…è¦æ³¨é‡Š

### 5. ä»£ç é£æ ¼ (Low)

- [ ] **ä¸€è‡´æ€§**ï¼šä¸é¡¹ç›®ç°æœ‰é£æ ¼ä¿æŒä¸€è‡´
- [ ] **æ ¼å¼åŒ–**ï¼šç¼©è¿›ã€ç©ºæ ¼ã€æ¢è¡Œæ˜¯å¦è§„èŒƒ
- [ ] **å¯¼å…¥é¡ºåº**ï¼šimport è¯­å¥æ˜¯å¦æœ‰åº

### 6. æµ‹è¯•å®¡æŸ¥ (Medium)

- [ ] **æµ‹è¯•è¦†ç›–**ï¼šæ–°ä»£ç æ˜¯å¦æœ‰å¯¹åº”æµ‹è¯•
- [ ] **AAA æ¨¡å¼**ï¼šæµ‹è¯•æ˜¯å¦éµå¾ª Arrange/Act/Assert ç»“æ„
- [ ] **è¾¹ç•Œç”¨ä¾‹**ï¼šæ˜¯å¦è¦†ç›–è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
- [ ] **æµ‹è¯•ç‹¬ç«‹æ€§**ï¼šæµ‹è¯•ä¹‹é—´æ˜¯å¦ç›¸äº’ç‹¬ç«‹
- [ ] **Mock ç±»å‹**ï¼šMock å¯¹è±¡æ˜¯å¦æœ‰æ­£ç¡®ç±»å‹ï¼Œé¿å… partial/empty

```typescript
// å¥½çš„æµ‹è¯•ç»“æ„ (AAA æ¨¡å¼)
describe('calculateTotal', () => {
  it('should apply discount for orders over $100', () => {
    // Arrange
    const items = [{ price: 50 }, { price: 60 }];
    const discount = 0.1;

    // Act
    const result = calculateTotal(items, discount);

    // Assert
    expect(result).toBe(99); // 110 * 0.9
  });
});
```

## è¾“å‡ºæ ¼å¼

å®¡æŸ¥ç»“æœæŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š

```markdown
## ä»£ç å®¡æŸ¥æŠ¥å‘Š

### æ¦‚è¿°
ç®€è¦æè¿°ä»£ç çš„åŠŸèƒ½å’Œæ•´ä½“è´¨é‡è¯„ä»·ã€‚

### å‘ç°çš„é—®é¢˜

#### Critical (å¿…é¡»ä¿®å¤)
- é—®é¢˜æè¿° + å…·ä½“ä½ç½® + ä¿®å¤å»ºè®®

#### High (å¼ºçƒˆå»ºè®®ä¿®å¤)
- é—®é¢˜æè¿° + å…·ä½“ä½ç½® + ä¿®å¤å»ºè®®

#### Medium (å»ºè®®æ”¹è¿›)
- é—®é¢˜æè¿° + å…·ä½“ä½ç½® + æ”¹è¿›å»ºè®®

#### Low (å¯é€‰ä¼˜åŒ–)
- é—®é¢˜æè¿° + å…·ä½“ä½ç½® + ä¼˜åŒ–å»ºè®®

### äº®ç‚¹
åˆ—å‡ºä»£ç ä¸­åšå¾—å¥½çš„åœ°æ–¹ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

### æ€»ç»“
- æ€»ä½“è¯„åˆ†ï¼šâ­â­â­â­â˜† (4/5)
- æ˜¯å¦å»ºè®®åˆå¹¶ï¼šæ˜¯/å¦/éœ€è¦ä¿®æ”¹åå†å®¡
```

## å¸¸è§é—®é¢˜é€ŸæŸ¥

| é—®é¢˜ç±»å‹ | å¿«é€Ÿæ£€æµ‹æ–¹æ³• |
|---------|-------------|
| XSS | æœç´¢ `innerHTML`, `dangerouslySetInnerHTML` |
| ç¡¬ç¼–ç å¯†é’¥ | æœç´¢ `password`, `secret`, `token`, `api_key` |
| æœªå¤„ç† Promise | æœç´¢ç¼ºå°‘ `.catch()` æˆ– `try-catch` çš„ `await` |
| ç±»å‹é—®é¢˜ | æœç´¢ `: any`, `as any` |
| å†…å­˜æ³„æ¼ | æ£€æŸ¥ `addEventListener`, `setInterval` æ˜¯å¦æœ‰å¯¹åº”æ¸…ç† |

## PR å®¡æŸ¥æŠ€å·§

### å®¡æŸ¥å‰

- **å…ˆè¯» PR æè¿°**ï¼šç†è§£å˜æ›´ç›®çš„ï¼Œé¿å…åç¦»ä¸»é¢˜çš„å»ºè®®
- **æ£€æŸ¥ PR å¤§å°**ï¼šè¶…è¿‡ 500 è¡Œå»ºè®®æ‹†åˆ†ï¼ˆ"5 è¡Œæ‰¾ 5 ä¸ª bugï¼Œ500 è¡Œç›´æ¥ LGTM"ï¼‰
- **å…³è” issue**ï¼šç¡®è®¤ PR è§£å†³äº†æ­£ç¡®çš„é—®é¢˜

### å®¡æŸ¥ä¸­

| åŸåˆ™ | è¯´æ˜ |
|-----|------|
| å…³æ³¨è®¾è®¡ | ä¼˜å…ˆå®¡æŸ¥æ¶æ„å’Œè®¾è®¡å†³ç­–ï¼Œè€Œéä»£ç é£æ ¼ |
| é¿å… nitpick | ä¸è¦å› ä¸º"æˆ‘ä¼šè¿™æ ·å†™"å°±å»ºè®®ä¿®æ”¹ |
| å…·ä½“å¯è¡Œ | æ¯æ¡è¯„è®ºéƒ½åº”æœ‰å…·ä½“çš„æ”¹è¿›å»ºè®® |
| è‚¯å®šäº®ç‚¹ | å‘ç°å¥½çš„å®ç°ä¹Ÿè¦æŒ‡å‡º |

### å®¡æŸ¥å

- **æ˜ç¡®ç»“è®º**ï¼šApprove / Request Changes / Comment
- **è·Ÿè¿›ä¿®æ”¹**ï¼šä½œè€…ä¿®æ”¹ååŠæ—¶ re-review

## è‡ªåŠ¨åŒ–å·¥å…·æ¨è

åœ¨äººå·¥å®¡æŸ¥å‰ï¼Œåº”ç¡®ä¿ä»¥ä¸‹è‡ªåŠ¨åŒ–æ£€æŸ¥é€šè¿‡ï¼š

| å·¥å…· | ç”¨é€” | å‘½ä»¤ |
|-----|------|------|
| **ESLint** | ä»£ç è§„èŒƒæ£€æŸ¥ | `npx eslint .` |
| **Prettier** | ä»£ç æ ¼å¼åŒ– | `npx prettier --check .` |
| **TypeScript** | ç±»å‹æ£€æŸ¥ | `npx tsc --noEmit` |
| **npm audit** | ä¾èµ–å®‰å…¨æ£€æŸ¥ | `npm audit` |
| **Jest/Vitest** | å•å…ƒæµ‹è¯• | `npm test` |

**æ¨è CI é…ç½®ï¼š**
```yaml
# åœ¨ PR æ—¶è‡ªåŠ¨è¿è¡Œ
- npm ci
- npm run lint
- npm run type-check
- npm run test
- npm audit --audit-level=high
```

---

**å‚è€ƒèµ„æºï¼š**
- [Microsoft Engineering Playbook](https://microsoft.github.io/code-with-engineering-playbook/code-reviews/)
- [Google Engineering Practices](https://google.github.io/eng-practices/review/)
- [GitHub Staff Engineer Philosophy](https://github.blog/developer-skills/github/how-to-review-code-effectively-a-github-staff-engineers-philosophy/)
